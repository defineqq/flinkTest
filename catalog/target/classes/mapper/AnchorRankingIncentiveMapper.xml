<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="service.AnchorRankingIncentiveMapper">

    <select id="selectCompanyId" timeout="300000" resultType="string">

        select
        tb1.brokerage_company_id
        from liveme_signeranchor tb1
        join liveme_signeranchor_contract tb2
        on tb1.contract_id = tb2.id and tb2.status=1
        and tb1.is_delete='False' and tb2.action != ''
        and tb2.diamond_source_app_ids is not null
        and tb1.app_id != 10058 and tb2.app_id != 10058 AND tb2.area='A_AR' AND tb1.uid=#{uid}
        order by tb2.updated_at desc
        limit 1
    </select>

    <insert id="insert" parameterType="models.SigneracnchorRankingModel">

        insert into anchor_ranking_incentive_total (unique_key,signeranchor_id, regional,agency_id,
        exposure_num,diamond_num,uv,remain_num, add_fans,data_at)
        value(#{uniqueKey},#{signerAnchorId} ,#{regional},#{agencyId}, #{exposureNum},#{diamondNum},#{uv},#{remainNum},
        #{addFans},#{dataAt})
        ON DUPLICATE KEY UPDATE
        <if test="uv != null and uv > 0">
            uv = uv + #{uv},
        </if>

        <if test="exposureNum != null and exposureNum > 0 ">
            exposure_num = exposure_num + #{exposureNum},
        </if>

        <if test="diamondNum != null and diamondNum != 0 ">
            diamond_num = diamond_num + #{diamondNum},
        </if>

        <if test="remainNum != null and remainNum > 0 ">
            remain_num = remain_num + #{remainNum},
        </if>

        <if test="addFans != null and addFans > 0 ">
            add_fans = add_fans + #{addFans},
        </if>

        agency_id = #{agencyId}
    </insert>

</mapper>